<%
  entries = []

  page_collection(locale_obj[:lang]).each do |page|
    if (
      page &&
      page[:category] &&
      page[:meta_description] &&
      page[:title] &&
      page[:content] && # has content (en, or otherwise)
      ConfigHelper.help_page_url_slug(page) # has a url
    )
      entries << {
        id:                    page[:id],
        title:                 page[:title],
        page_slug:             localize_path(ConfigHelper.help_page_url_slug(page), locale_id: locale_obj[:id]),
        page_meta_description: page[:meta_description],

        # reduce the amount of data downloaded in browsers
        content:               SearchHelper::condense_content(page[:content].to_s.gsub(%r{[\[\]#\*<>\/]}, ' ')),
        keywords:              page[:keywords]&.to_s,

        # get all locales this is written in, eg. page.content.en = 'â€¦'
        # this is more of a "primary-locales" as it should be available in all locales
        page_locales:          page[:content_locales]
      }
    end
  end
%><%= entries.to_json %>
