<%
  entries = []

  page_collection(locale_obj[:lang]) do |page|
    if (
      page &&
      page[:category] &&
      page[:meta_description] &&
      page[:title] &&
      page[:content] && # has content (en, or otherwise)
      ConfigHelper.help_page_url_slug(page) # has a url
    )
      raw_page = data.help.pages.find{ |id, _page| _page[:id] == page[:id] }

      entries << {
        :id                     => page[:id],
        :title                  => page[:title],
        :page_slug              => ConfigHelper.help_page_url_slug(page),
        :page_meta_description  => page[:meta_description],

        # reduce the amount of data downloaded in browsers
        :content                => SearchHelper::condense_content(page.content.to_s.gsub(%r{[\[\]#\*<>\/]}, ' '))

        # get all locales this is written in, eg. page.content.en = 'â€¦'
        # this is more of a "first-class-page-locales"
        :page_locales           => raw_page[:content][:keys],
      }
    end
  end
%>

<%= entries.to_json %>
